<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>GOD13 | ê³µì‹ ì»¤ë®¤ë‹ˆí‹°</title>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyApxbnjQR06-1LJi-oonGV70YoPgd7nuRA",
  authDomain: "god13-79e4e.firebaseapp.com",
  projectId: "god13-79e4e",
  storageBucket: "god13-79e4e.appspot.com",
  messagingSenderId: "978260301114",
  appId: "1:978260301114:web:23c79352313d5b787cec03"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const ADMIN_EMAIL = "admin@god13.com";

// ===== AUTH =====
window.login = async () => {
  await signInWithEmailAndPassword(auth, email.value, password.value);
};

window.signup = async () => {
  await createUserWithEmailAndPassword(auth, email.value, password.value);
};

window.logout = async () => {
  await signOut(auth);
};

onAuthStateChanged(auth, user => {
  if (!user) {
    authBox.classList.remove("hidden");
    appBox.classList.add("hidden");
    return;
  }
  authBox.classList.add("hidden");
  appBox.classList.remove("hidden");
  userEmail.innerText = user.email;

  if (user.email === ADMIN_EMAIL) {
    adminPanel.classList.remove("hidden");
  } else {
    adminPanel.classList.add("hidden");
  }

  loadNotices();
  loadResults();
});

// ===== NOTICE =====
window.addNotice = async () => {
  await addDoc(collection(db, "notices"), {
    text: noticeInput.value,
    time: Date.now()
  });
  noticeInput.value = "";
  loadNotices();
};

async function loadNotices() {
  noticeList.innerHTML = "";
  const snap = await getDocs(collection(db, "notices"));
  snap.forEach(d => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = d.data().text;

    if (!adminPanel.classList.contains("hidden")) {
      const del = document.createElement("button");
      del.innerText = "ì‚­ì œ";
      del.onclick = async () => {
        await deleteDoc(doc(db, "notices", d.id));
        loadNotices();
      };
      div.appendChild(del);
    }
    noticeList.appendChild(div);
  });
}

// ===== RESULT =====
window.addResult = async () => {
  await addDoc(collection(db, "results"), {
    name: resultName.value,
    type: resultType.value
  });
  loadResults();
};

async function loadResults() {
  resultList.innerHTML = "";
  const snap = await getDocs(collection(db, "results"));
  snap.forEach(d => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerText = `${d.data().name} - ${d.data().type}`;
    resultList.appendChild(div);
  });
}
</script>

<style>
body{margin:0;background:#020617;color:white;font-family:Pretendard,Arial}
header{padding:18px;text-align:center;font-size:22px;font-weight:900;border-bottom:1px solid #111827}
.box{max-width:520px;margin:30px auto;background:#0f172a;padding:20px;border-radius:16px;border:1px solid #111827}
input,select,button{width:100%;padding:12px;margin-top:10px;border-radius:10px;border:none;font-size:15px}
button{background:#2563eb;color:white;cursor:pointer}
button:hover{background:#1d4ed8}
.hidden{display:none}
.item{background:#020617;padding:10px;border-radius:10px;margin-top:8px}
.admin{border:1px solid #22c55e;margin-top:16px;padding:14px;border-radius:12px}
</style>
</head>

<body>
<header>ğŸ”¥ GOD13 ê³µì‹ ì»¤ë®¤ë‹ˆí‹°</header>

<div class="box" id="authBox">
  <h3>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h3>
  <input id="email" placeholder="ì´ë©”ì¼" />
  <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
  <button onclick="login()">ë¡œê·¸ì¸</button>
  <button onclick="signup()">íšŒì›ê°€ì…</button>
</div>

<div class="box hidden" id="appBox">
  <div>ì ‘ì†: <b id="userEmail"></b></div>
  <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>

  <h3>ğŸ“¢ ê³µì§€</h3>
  <div id="noticeList"></div>

  <div class="admin hidden" id="adminPanel">
    <h3>ğŸ›¡ ê´€ë¦¬ì íŒ¨ë„</h3>
    <input id="noticeInput" placeholder="ê³µì§€ ë‚´ìš©" />
    <button onclick="addNotice()">ê³µì§€ ì¶”ê°€</button>

    <h4>ì˜ì¬ ê²°ê³¼ ì¶”ê°€</h4>
    <input id="resultName" placeholder="ë‹‰ë„¤ì„" />
    <select id="resultType">
      <option>ì •ë³´</option>
      <option>ê³¼í•™</option>
    </select>
    <button onclick="addResult()">ê²°ê³¼ ì¶”ê°€</button>
  </div>

  <h3>ğŸ“ ì˜ì¬ ê²°ê³¼</h3>
  <div id="resultList"></div>
</div>

</body>
</html>
