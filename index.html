<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>GOD13 Enterprise</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:Pretendard,system-ui;background:#020617;color:#fff}
.hidden{display:none}
header{padding:18px;text-align:center;font-size:22px;font-weight:700;border-bottom:1px solid #1e293b}
section{max-width:900px;margin:20px auto;padding:16px}
.card{background:#020617;border:1px solid #1e293b;border-radius:16px;padding:18px;margin-bottom:14px}
input,button{padding:12px;border-radius:10px;border:none;font-size:15px}
input{width:100%;margin-bottom:10px;background:#020617;color:#fff;border:1px solid #1e293b}
button{background:#2563eb;color:#fff;cursor:pointer}
button:hover{background:#1d4ed8}
.notice{border-bottom:1px solid #1e293b;padding:10px 0}
.admin{background:#7c2d12}
</style>
</head>
<body>
<header>ğŸ”¥ GOD13 ENTERPRISE</header>

<section id="auth">
<div class="card">
<h3>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h3>
<input id="email" placeholder="ì´ë©”ì¼" />
<input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
<button onclick="login()">ë¡œê·¸ì¸</button>
<button onclick="signup()">íšŒì›ê°€ì…</button>
</div>
</section>

<section id="app" class="hidden">
<div class="card">
<h3>ê³µì§€ì‚¬í•­</h3>
<div id="notices"></div>
</div>

<div class="card hidden" id="adminPanel">
<h3>ğŸ›¡ ê´€ë¦¬ì íŒ¨ë„</h3>
<input id="noticeInput" placeholder="ê³µì§€ ë‚´ìš©" />
<button onclick="postNotice()">ê³µì§€ ì‘ì„±</button>
</div>

<button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyApxbnjQR06-1LJi-oonGV70YoPgd7nuRA",
  authDomain: "god13-79e4e.firebaseapp.com",
  projectId: "god13-79e4e",
  storageBucket: "god13-79e4e.appspot.com",
  messagingSenderId: "978260301114",
  appId: "1:978260301114:web:23c79352313d5b787cec03"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const ADMIN = "admin@god13.com";

window.login = async () => {
  await signInWithEmailAndPassword(auth, email.value, password.value);
};

window.signup = async () => {
  const cred = await createUserWithEmailAndPassword(auth, email.value, password.value);
  await setDoc(doc(db, "users", cred.user.uid), {
    email: cred.user.email,
    role: cred.user.email === ADMIN ? "admin" : "user"
  });
};

window.logout = async () => signOut(auth);

onAuthStateChanged(auth, async user => {
  if(!user){ authSection(true); return; }
  authSection(false);
  const snap = await getDoc(doc(db,"users",user.uid));
  if(snap.exists() && snap.data().role === "admin"){
    adminPanel.classList.remove("hidden");
  }
  loadNotices();
});

function authSection(showAuth){
  document.getElementById('auth').classList.toggle('hidden', !showAuth);
  document.getElementById('app').classList.toggle('hidden', showAuth);
}

function loadNotices(){
  const q = query(collection(db,"notices"), orderBy("created","desc"));
  onSnapshot(q, snap => {
    notices.innerHTML = "";
    snap.forEach(d => notices.innerHTML += `<div class='notice'>${d.data().text}</div>`);
  });
}

window.postNotice = async () => {
  await addDoc(collection(db,"notices"), {
    text: noticeInput.value,
    created: new Date()
  });
  noticeInput.value = "";
};
</script>
</body>
</html>
