<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GOD13</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; font-family: Pretendard, sans-serif; }
    body { margin:0; background:#0b0f19; color:#fff; }
    .hidden{display:none}
    header{padding:24px 40px;border-bottom:1px solid #1f2937;display:flex;justify-content:space-between;align-items:center}
    header h1{font-size:22px;font-weight:900}
    button{background:#2563eb;border:none;color:white;padding:10px 16px;border-radius:10px;font-weight:600;cursor:pointer}
    button.danger{background:#dc2626}
    main{padding:40px;max-width:1200px;margin:auto}
    .card{background:#111827;border-radius:16px;padding:24px;margin-bottom:24px;box-shadow:0 10px 30px rgba(0,0,0,.4)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:24px}
    input,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid #374151;background:#020617;color:white}
    textarea{resize:none;height:120px}
    .notice{border-left:4px solid #2563eb;padding-left:16px;margin-bottom:16px}
    .admin{border-left-color:#dc2626}
    footer{text-align:center;color:#6b7280;padding:40px 0}
  </style>
</head>
<body>
<header>
  <h1>GOD13</h1>
  <div id="userArea"></div>
</header>

<main>
  <section id="authSection" class="card">
    <h2>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h2>
    <input id="email" placeholder="ì´ë©”ì¼" />
    <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
    <div style="margin-top:12px;display:flex;gap:8px">
      <button id="loginBtn">ë¡œê·¸ì¸</button>
      <button id="signupBtn">íšŒì›ê°€ì…</button>
    </div>
  </section>

  <section id="appSection" class="hidden">
    <div class="grid">
      <div class="card">
        <h3>ğŸ“¢ ê³µì§€ì‚¬í•­</h3>
        <div id="noticeList"></div>
      </div>

      <div id="adminPanel" class="card hidden">
        <h3>ğŸ›¡ ê´€ë¦¬ì íŒ¨ë„</h3>
        <textarea id="noticeText" placeholder="ê³µì§€ ë‚´ìš©"></textarea>
        <button id="postNotice" style="margin-top:10px">ê³µì§€ ì˜¬ë¦¬ê¸°</button>
      </div>
    </div>
  </section>
</main>

<footer>GOD13 Â© 2026</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, doc, setDoc, getDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyApxbnjQR06-1LJi-oonGV70YoPgd7nuRA",
  authDomain: "god13-79e4e.firebaseapp.com",
  projectId: "god13-79e4e",
  storageBucket: "god13-79e4e.appspot.com",
  messagingSenderId: "978260301114",
  appId: "1:978260301114:web:23c79352313d5b787cec03"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const authSection = document.getElementById('authSection');
const appSection = document.getElementById('appSection');
const adminPanel = document.getElementById('adminPanel');
const noticeList = document.getElementById('noticeList');
const userArea = document.getElementById('userArea');

loginBtn.onclick = async () => {
  await signInWithEmailAndPassword(auth, email.value, password.value);
};

signupBtn.onclick = async () => {
  const cred = await createUserWithEmailAndPassword(auth, email.value, password.value);
  await setDoc(doc(db,'users',cred.user.uid),{
    email:cred.user.email,
    role:cred.user.email==='admin@god13.com'?'admin':'user'
  });
};

postNotice.onclick = async () => {
  await addDoc(collection(db,'notices'),{
    text: noticeText.value,
    createdAt: serverTimestamp()
  });
  noticeText.value='';
};

onAuthStateChanged(auth, async user => {
  if(!user){
    authSection.classList.remove('hidden');
    appSection.classList.add('hidden');
    userArea.innerHTML='';
    return;
  }

  authSection.classList.add('hidden');
  appSection.classList.remove('hidden');
  userArea.innerHTML = `<button id="logout">ë¡œê·¸ì•„ì›ƒ</button>`;
  logout.onclick=()=>signOut(auth);

  const snap = await getDoc(doc(db,'users',user.uid));
  if(snap.exists() && snap.data().role==='admin'){
    adminPanel.classList.remove('hidden');
  }
});

const q = query(collection(db,'notices'), orderBy('createdAt','desc'));
onSnapshot(q, snap => {
  noticeList.innerHTML='';
  snap.forEach(d=>{
    const div=document.createElement('div');
    div.className='notice';
    div.innerText=d.data().text;
    noticeList.appendChild(div);
  });
});
</script>
</body>
</html>
